<script>
  // หลังจาก stop recorder
  recorder.onstop = async () => {
    const blob = new Blob(chunks, { type: "audio/webm" });
    audio.src = URL.createObjectURL(blob);

    // สร้าง FormData
    const fd = new FormData();
    fd.append("file", blob, "voice_recording.webm");

    // ใส่ URL ของ Webhook ที่ได้จาก n8n
    const webhookUrl = "https://pb-n8n.planbmedia.co.th/webhook-test/voice";

    try {
      const res = await fetch(webhookUrl, {
        method: "POST",
        body: fd
      });

      if(res.ok){
        alert("✅ ส่งไฟล์ไป n8n สำเร็จ!");
      } else {
        alert("❌ ส่งไฟล์ไป n8n ไม่สำเร็จ!");
      }
    } catch(err){
      console.error(err);
      alert("❌ เกิดข้อผิดพลาดในการส่งไฟล์");
    }
  };
</script>
